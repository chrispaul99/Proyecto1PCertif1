<script src='https://api.mapbox.com/mapbox-gl-js/v1.11.0/mapbox-gl.js'></script>
<link href='https://api.mapbox.com/mapbox-gl-js/v1.11.0/mapbox-gl.css' rel='stylesheet' />
@model BEUProyecto.Direccion
@{
    ViewBag.Title = "CreateNegocio";
    Layout = "~/Views/Shared/_LayoutPanelComerciante.cshtml";
}
<div class="flex-fill d-flex flex-column justify-content-center">
    <div class="container-tight py-6">
        <div class="mb-5 text-center">
            <a href='@Url.Action("Index", "Home")'>
                <img src='@Url.Content("~/images/logo-black.svg")' height="100" />
            </a>
        </div>
        @using (Html.BeginForm("CreateNegocio", "Direcciones", FormMethod.Post, new { id = ViewBag.id }))
        {
            @Html.AntiForgeryToken()
            <div class="form-group">
                <h3> Seleccione la ubicacion de su negocio</h3>
                <div class="mb-3">
                    <div class="embed-responsive embed-responsive-16by9">
                        <div class="embed-responsive-item">
                            <div id="map-simple" class="w-100 h-100"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="form-group">
                @Html.LabelFor(model => model.referencia, htmlAttributes: new { @class = "control-label col-md-2" })
                <div class="mb-3">
                    @Html.EditorFor(model => model.referencia, new { htmlAttributes = new { @class = "form-control" }, placeholder = "Referencia del Domicilio" })

                    @Html.ValidationMessageFor(model => model.referencia, "", new { @class = "text-danger" })
                </div>
            </div>
            <div class="form-group">
                <div class="mb-3">
                    @Html.TextAreaFor(model => model.nombre, new { style = "display:" + "none" + ";" })
                    @Html.TextAreaFor(model => model.latitud, new { style = "display:" + "none" + ";" })
                    @Html.TextAreaFor(model => model.longitud, new { style = "display:" + "none" + ";" })
                </div>
            </div>
            <div class="form-footer">
                <button type="submit" class="btn btn-success btn-block" id="direccion">Siguiente</button>
            </div>
        }
    </div>
</div>
<script>
    mapboxgl.accessToken = 'pk.eyJ1IjoiY2hyaXNlZG03IiwiYSI6ImNrOWo1N3FiMzA5a2QzdGw2bDgwdHB5OWYifQ._GeVlAXvOxWTJe-2rAVphQ';
    var map = new mapboxgl.Map({
        container: 'map-simple',
        style: 'mapbox://styles/mapbox/streets-v11',
        center: [-78.183406, -1.831239],
        zoom: 6
    });
    map.addControl(new mapboxgl.NavigationControl());
    map.addControl(new mapboxgl.GeolocateControl());
    map.addControl(new mapboxgl.FullscreenControl());
    var markerAux = null;
    var marker = {};
    map.on('click', function (e) {
        lat = JSON.stringify(e.lngLat.lat);
        lon = JSON.stringify(e.lngLat.lng);
        if (markerAux == null) {
            marker = new mapboxgl.Marker({
                draggable: true
            })
                .setLngLat([lon, lat])
                .addTo(map);
            markerAux = marker;
            marker.on('dragend', 'onDragEnd');

            document.getElementById("longitud").innerHTML = lon;
            document.getElementById("latitud").innerHTML = lat;
            document.getElementById("nombre").innerHTML = "Domicilio";

        }
    })
    function onDragEnd() {
        var lngLat = marker.getLngLat();
        document.getElementById("longitud").innerHTML = lon;
        document.getElementById("latitud").innerHTML = lat;
        document.getElementById("nombre").innerHTML = "Domicilio";
    }
</script>

